#!/bin/bash
# cpanel server stats GPL

HOST=`hostname`;HTTPD='/usr/local/apache/conf/httpd.conf'; 
PHP=`php -i | grep php.ini | grep "Configuration" | cut -d ">" -f2 | cut -c 2- | tail -n 1`; 
MYSQL='/etc/my.cnf'; echo -e 
"\n=== SERVER STATS ===\n"; echo -e "Host: `hostname`"; echo -e "\n=== Version Info ===\n"; cat /etc/redhat-release; echo -e ""; /usr/local/cpanel/cpanel -V; echo -e ""; /usr/local/apache/bin/httpd -v | grep nix ; echo -e ""; /usr/local/bin/php -v | grep cli; echo -e ""; /usr/bin/mysql -V | cut -d "," -f1; echo -e "\n=== Current Mail in Queue ===\n"; exim -bpc; echo -e "\n=== Disk Space Usage ===\n"; df -h; echo -e "\n=== Current Memory Usage ===\n"; free -m; echo -e "\n=== Number of Processors ===\n"; grep -c proc /proc/cpuinfo; echo -e "\n=== PHP Info ===\n"; grep "memory_limit" $PHP; grep "max_execution_time" $PHP; grep "max_input_time" $PHP; grep "post_max_size" $PHP; grep "upload_max_filesize" $PHP; grep "max_file_uploads" $PHP; echo -e "\n=== PHP Handler ===\n"; /usr/local/cpanel/bin/rebuild_phpconf --current; echo -e "\n=== Number of PHP Processes ===\n"; ps faux | grep php -c | grep -v grep; echo -e "\n=== Number of Apache Processes ===\n"; ps faux | grep httpd -c | grep -v grep; echo -e "\n=== Apache Configuation ===\n"; /etc/init.d/httpd -V | grep MPM; grep "KeepAlive " $HTTPD; egrep 'MaxClients|KeepAlive|MaxRequestsPerChild|Timeout|Servers|Threads|ServerLimit' $HTTPD; echo -e "\n=== MaxClients Hits ===\n"; grep MaxClients /usr/local/apache/logs/error_log |tail; echo -e "\n=== Graceful Restarts ===\n"; grep Graceful /usr/local/apache/logs/error_log |tail; echo -e "\n=== Number of SYN connections ===\n"; netstat -nap | grep SYN | wc -l; echo -e "\n=== Top 10 SYN Flood Conections ===\n"; netstat -tn 2>/dev/null | grep SYN | awk '{print $5}' | cut -f1 -d: | sort | uniq -c | sort -rn | head; echo -e "\n=== Top 10 connections to apache ===\n"; netstat -tn 2>/dev/null | grep :80 | awk '{print $5}' | cut -f1 -d: | sort | uniq -c | sort -rn | head; echo -e "\n=== Port 80 Connections ===\n"; netstat -tn 2>/dev/null | grep :80 | wc -l; echo -e "\n=== Number of IPs Connected ===\n"; netstat -tn 2>/dev/null | grep :80 | awk '{print $5}' | cut -f1 -d: | sort | uniq -c | sort -rn | wc -l; echo -e "\n=== WordPress Brute Force ===\n"; grep -s wp-login.php /usr/local/apache/domlogs/* | grep POST | grep "$(date +"%d/%b/%Y")" | cut -d: -f1 | sort| uniq -c | sort -nr | head; echo -e "\n=== Number of MySQL Connections ===\n"; netstat -nap | grep -i sql.sock | wc -l; echo -e "\n=== MySQL Database queries ===\n"; mysqladmin proc stat; echo -e "\n=== MySQL Databases ===\n"; du --max-depth=1 /var/lib/mysql | sort -nr | cut -f2 | xargs du -sh 2>/dev/null | head | cut -d "/" -f1,5; echo -e "\n=== MySQL Errors ===\n"; cat /var/lib/mysql/${HOST}.err | tail; echo -e "\n=== MySQL Connections ===\n"; mysql -e 'show status;' |grep connect; echo -e "\n=== MySQL Configuration ===\n"; egrep 'max_connections|max_heap_table_size|tmp_table_size|query_cache_size|timeout|table_cache|open_files|thread|innodb' $MYSQL; echo -e "\n=== CPANEL SETTINGS ===\n"; egrep -i 'piped|extracpus' /var/cpanel/cpanel.config; 

