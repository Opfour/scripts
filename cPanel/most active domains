echo Most Active Domains; find /usr/local/apache/domlogs/ -maxdepth 1 -type f -mtime -1 |egrep -v '(-\w{5,9}_log)'| xargs grep -cP "^[^\]]+\[$(date +%d'/'%b'/'%Y)" |grep :.. |sort -t: -nr -k 2 |head -5 |tee /tmp/delete_domlog; echo; for domlog in $(cut -d':' -f1 /tmp/delete_domlog); do echo $domlog; echo GET $(grep -P "^[^\]]+\[$(date +%d'/'%b'/'%Y)" $domlog | grep -c GET); grep -P "^[^\]]+\[$(date +%d'/'%b'/'%Y)" $domlog | grep GET |cut -d' ' -f7 |sort |uniq -c |sort -nr |head -5; echo POST $(grep -P "^[^\]]+\[$(date +%d'/'%b'/'%Y)" $domlog | grep -c POST); grep -P "^[^\]]+\[$(date +%d'/'%b'/'%Y)" $domlog | grep POST |cut -d' ' -f7 |sort |uniq -c |sort -nr |head -5; done

SARBLOB=$( LANG=C sar -q | tail ) ; SPIKE=$( echo "${SARBLOB}" | egrep -v '(\ .\.|A)' ) ; HOURMIN=$( echo "${SARBLOB}" | grep -B2 "${SPIKE}" | egrep -o ..:. | head -3 ) ; TIME=$( echo "${HOURMIN}" | while read LINE ; do echo $(date +"%d/%b/%Y"):$LINE ; done ) ; args=(${TIME}) ; for i in 0 1 2 ; do echo ; echo ===${args[$i]}=== ; for FILE in $(grep -l ${args[$i]} /usr/local/apache/domlogs/*) ; do echo $FILE ; ENTRIES=$(grep ${args[$i]} $FILE) ; echo POST $(echo "$ENTRIES" | grep -c POST) ; echo "$ENTRIES" | grep POST | cut -d' ' -f1 | sort | uniq -c | sort -nr | head -5 ; echo ; echo "$ENTRIES" | grep POST | cut -d' ' -f7 | sort | uniq -c | sort -nr | head -5 ; echo ; echo GET $(echo "$ENTRIES" | grep -c GET) ; echo "$ENTRIES" | grep GET | cut -d' ' -f1 | sort | uniq -c | sort -nr | head -5 ; echo ; echo "$ENTRIES" | grep GET | cut -d' ' -f7 | sort | uniq -c | sort -nr | head -5 ; done ; done ;
